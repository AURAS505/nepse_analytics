{% extends 'base.html' %}
{% load humanize %}

{% block title %}Company Trades - Hathway Analytics Suite{% endblock %}

{% block styles %}
    {# --- ADDED FLATPICKR CSS --- #}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        body { background-color: #f8f9fa; }

        .table-container { max-height: 60vh; overflow-y: auto; }
        .table th { position: sticky; top: 0; background-color: #f8f9fa; }

        .sortable-th { cursor: pointer; position: relative; }
        .sortable-th::after, .sortable-th::before { 
            content: ''; 
            position: absolute; 
            right: 0.1rem; 
            font-size: 1.2em; 
            opacity: 0.3; 
            border: 4px solid transparent; 
        }
        .sortable-th::before { border-bottom-color: currentColor; top: 0.1rem; }
        .sortable-th::after { border-top-color: currentColor; bottom: 0.1rem; }
        .sortable-th.asc::before, .sortable-th.desc::after { opacity: 1; color: #0d6efd; }

        .nav-custom .nav-link { 
            padding: 0.5rem 1rem; 
            border-radius: 0.375rem; 
            font-size: 0.9rem; 
            font-weight: 500; 
            color: #4B5563; 
        }
        .nav-custom .nav-link:hover { background-color: #F3F4F6; }
        .nav-custom .nav-link.active { color: #0d6efd; background-color: #e7f1ff; }

        .modal { display: none; position: fixed; z-index: 1050; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); }
        .modal-dialog-centered { display: flex; align-items: center; min-height: calc(100% - 1rem); }
        .modal-content { position: relative; display: flex; flex-direction: column; width: 100%; pointer-events: auto; background-color: #fff; background-clip: padding-box; border: 1px solid rgba(0,0,0,.2); border-radius: 0.1rem; outline: 0; max-height: 90vh; }
        .modal-header { display: flex; flex-shrink: 0; align-items: center; justify-content: space-between; padding: 1rem 1rem; border-bottom: 1px solid #dee2e6; }
        .modal-body { position: relative; flex: 1 1 auto; padding: 1rem; overflow-y: auto; }
        .modal-title { margin-bottom: 0; line-height: 1.5; }
        .btn-close { box-sizing: content-box; width: 1em; height: 1em; padding: .25em .25em; color: #000; background: transparent; border: 0; border-radius: .25rem; opacity: .5; }
        .loading-spinner { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 20px auto; display: none; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .card-header { padding: 0.1rem 1rem; }

        /* --- UPDATED FONT SIZES --- */
        .numerical-data { 
            font-size: 1.1rem;   /* increased from 0.9rem */
            font-weight: 600;
            font-variant-numeric: tabular-nums; 
        }

        .clickable-detail { 
            cursor: pointer; 
            font-size: 1.2rem !important;  /* increased from inherited 0.85rem */
            font-weight: 600; 
            color: #0d6efd !important;     /* same blue as Bootstrap primary */
            transition: color 0.2s ease-in-out;
        }

        .clickable-detail:hover { 
            color: #084298 !important;     /* darker blue on hover */
            text-decoration: underline;
        }

        /* Table padding */
        .table-sm > :not(caption) > * > * { 
            padding: 0.2rem 0.4rem; 
        }
    </style>
{% endblock styles %}


{% block content %}
<div class="container-fluid mt-4">
    <nav class="nav nav-pills flex-column flex-sm-row nav-custom justify-content-center mb-4 bg-white p-2 rounded-3 shadow-sm">
        <a class="flex-sm-fill text-sm-center nav-link" href="{% url 'floorsheet_analysis:settlement_report' %}">Settlement Report</a>
        <a class="flex-sm-fill text-sm-center nav-link" href="#">Live Floorsheet</a>
        <a class="flex-sm-fill text-sm-center nav-link active" aria-current="page" href="{% url 'floorsheet_analysis:company_trades_report' %}">Company Trades</a>
        <a class="flex-sm-fill text-sm-center nav-link" href="{% url 'floorsheet_analysis:broker_trades_report' %}">Broker Trades</a>
        <a class="flex-sm-fill text-sm-center nav-link" href="{% url 'floorsheet_analysis:stock_holding_history_report' %}">Daily Holdings</a>
        <a class="flex-sm-fill text-sm-center nav-link" href="#">Accum/Dist</a>
    </nav>

    <div class="row">
        <div class="col-xl-12">
            <div class="card card-body mb-4 py-3">
                
                <form method="POST" action="{% url 'floorsheet_analysis:company_trades_report' %}" class="row g-2 align-items-end">
                    {% csrf_token %}
                    <div class="col-lg-2 col-md-4">
                        <label for="stock_symbol" class="form-label small mb-1">Stock Symbol</label>
                        <select name="stock_symbol" id="stock_symbol" class="form-select form-select-sm">
                            {% for stock in stocks %}
                                <option value="{{ stock.stock_symbol }}" {% if stock.stock_symbol == selected_stock %}selected{% endif %}>{{ stock.stock_symbol }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-lg-2 col-md-4">
                        <label for="date_range_type" class="form-label small mb-1">Date Range</label>
                        <select name="date_range_type" id="date_range_type" class="form-select form-select-sm">
                            <option value="custom" {% if selected_date_range_type == 'custom' %}selected{% endif %}>Custom</option>
                            <option value="current_day" {% if selected_date_range_type == 'current_day' %}selected{% endif %}>Current Day</option>
                            <option value="1_week" {% if selected_date_range_type == '1_week' %}selected{% endif %}>1 Week</option>
                            <option value="fortnight" {% if selected_date_range_type == 'fortnight' %}selected{% endif %}>Fortnight</option>
                            <option value="monthly" {% if selected_date_range_type == 'monthly' %}selected{% endif %}>Monthly</option>
                            <option value="quarterly" {% if selected_date_range_type == 'quarterly' %}selected{% endif %}>Quarterly</option>
                            <option value="semi_annually" {% if selected_date_range_type == 'semi_annually' %}selected{% endif %}>Semi-Annually</option>
                            <option value="yearly" {% if selected_date_range_type == 'yearly' %}selected{% endif %}>Yearly</option>
                        </select>
                    </div>
                    <div class="col-lg-2 col-md-4">
                        <label for="start_date" class="form-label small mb-1">Start Date</label>
                        {# --- CHANGED: type="text" and added disabled attribute --- #}
                        <input type="text" name="start_date" id="start_date" value="{{ start_date }}" class="form-control form-control-sm" {% if selected_date_range_type != 'custom' %}disabled{% endif %}>
                    </div>
                    <div class="col-lg-2 col-md-4">
                        <label for="end_date" class="form-label small mb-1">End Date</label>
                        {# --- CHANGED: type="text" and added disabled attribute --- #}
                        <input type="text" name="end_date" id="end_date" value="{{ end_date }}" class="form-control form-control-sm" {% if selected_date_range_type != 'custom' %}disabled{% endif %}>
                    </div>
                    <div class="col-lg-1 col-md-4">
                        <button type="submit" class="btn btn-primary btn-sm w-100">Filter</button>
                    </div>
                    
                    <div class="col-lg-3 col-md-4">
                        <div class="d-flex flex-column gap-1">
                            <div class="d-flex justify-content-between align-items-center">
                                <small class="text-muted mb-0">Total Kitta:</small>
                                <span class="fw-bold small">{{ overall_summary.total_traded_kitta|intcomma }}</span>
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <small class="text-muted mb-0">Total Amount:</small>
                                <span class="fw-bold small">Rs. {{ overall_summary.total_amount|floatformat:2|intcomma }}</span>
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <small class="text-muted mb-0">ATR:</small>
                                <span class="fw-bold small">{{ overall_summary.atr|floatformat:2|intcomma }}</span>
                            </div>
                        </div>
                    </div>
                </form>

            </div>
        </div>
    </div>
 
    <div class="row g-3">
        <div class="col-xl-3 col-lg-6 mb-3">
            <div class="card h-100">
                <div class="card-header bg-success text-white py-2">
                    <h6 class="mb-0">Top Buyers</h6>
                </div>
                <div class="card-body p-0 table-container">
                    <table class="table table-striped table-hover mb-0">
                        <thead>
                            <tr>
                                <th class="py-2">Buyer</th>
                                <th class="text-end py-2">Kitta</th>
                                <th class="text-end py-2">Amount</th>
                                <th class="text-end py-2">Avg. Rate</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for row in buyer_data %}
                            <tr>
                                <td class="fw-bold text-primary clickable-detail py-2" data-type="buyer" data-name="{{ row.buyer }}">{{ row.buyer }}</td>
                                <td class="text-end numerical-data py-2">{{ row.total_quantity|intcomma }}</td>
                                <td class="text-end numerical-data py-2">{{ row.total_amount|floatformat:2|intcomma }}</td>
                                <td class="text-end numerical-data py-2">{{ row.average_rate|floatformat:2|intcomma }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-lg-6 mb-3">
            <div class="card h-100">
                <div class="card-header bg-danger text-white py-2">
                    <h6 class="mb-0">Top Sellers</h6>
                </div>
                <div class="card-body p-0 table-container">
                    <table class="table table-striped table-hover mb-0">
                        <thead>
                            <tr>
                                <th class="py-2">Seller</th>
                                <th class="text-end py-2">Kitta</th>
                                <th class="text-end py-2">Amount</th>
                                <th class="text-end py-2">Avg. Rate</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for row in seller_data %}
                            <tr>
                                <td class="fw-bold text-primary clickable-detail py-2" data-type="seller" data-name="{{ row.seller }}">{{ row.seller }}</td>
                                <td class="text-end numerical-data py-2">{{ row.total_quantity|intcomma }}</td>
                                <td class="text-end numerical-data py-2">{{ row.total_amount|floatformat:2|intcomma }}</td>
                                <td class="text-end numerical-data py-2">{{ row.average_rate|floatformat:2|intcomma }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-lg-6 mb-3">
            <div class="card h-100">
                <div class="card-header bg-dark text-white py-2">
                    <h6 class="mb-0">Broker Net Position (Desc)</h6>
                </div>
                <div class="card-body p-0 table-container">
                    <table class="table table-striped table-hover mb-0">
                        <thead>
                            <tr>
                                <th class="py-2">Broker</th>
                                <th class="text-end py-2">Buy</th>
                                <th class="text-end py-2">Sell</th>
                                <th class="text-end py-2">Net</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for row in broker_net_data_desc %}
                            <tr>
                                <td class="fw-bold text-primary clickable-detail py-2" data-type="broker" data-name="{{ row.broker }}">{{ row.broker }}</td>
                                <td class="text-end numerical-data py-2">{{ row.total_buy_quantity|intcomma }}</td>
                                <td class="text-end numerical-data py-2">{{ row.total_sell_quantity|intcomma }}</td>
                                <td class="text-end numerical-data py-2">{{ row.net_quantity|intcomma }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-lg-6 mb-3">
            <div class="card h-100">
                <div class="card-header bg-secondary text-white py-2">
                    <h6 class="mb-0">Broker Net Position (Asc)</h6>
                </div>
                <div class="card-body p-0 table-container">
                    <table class="table table-striped table-hover mb-0">
                        <thead>
                            <tr>
                                <th class="py-2">Broker</th>
                                <th class="text-end py-2">Buy</th>
                                <th class="text-end py-2">Sell</th>
                                <th class="text-end py-2">Net</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for row in broker_net_data_asc %}
                            <tr>
                                <td class="fw-bold text-primary clickable-detail py-2" data-type="broker" data-name="{{ row.broker }}">{{ row.broker }}</td>
                                <td class="text-end numerical-data py-2">{{ row.total_buy_quantity|intcomma }}</td>
                                <td class="text-end numerical-data py-2">{{ row.total_sell_quantity|intcomma }}</td>
                                <td class="text-end numerical-data py-2">{{ row.net_quantity|intcomma }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="detailModal" class="modal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalTitle">Details</h5>
                <button type="button" class="btn-close close-button" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-2">
                    <button id="matchingButton" class="btn btn-sm btn-info d-none">Matching</button>
                </div>
                <div class="loading-spinner" id="modalSpinner"></div>
                <div class="table-container">
                    <table class="table table-sm table-striped">
                        <thead>
                            <tr>
                                <th class="sortable-th" data-sort-by="contract_no">Contract No.</th>
                                <th>Stock Symbol</th>
                                <th>Buyer</th>
                                <th>Seller</th>
                                <th class="text-end sortable-th" data-sort-by="quantity">Quantity</th>
                                <th class="text-end">Rate</th>
                                <th class="text-end sortable-th" data-sort-by="amount">Amount</th>
                            </tr>
                        </thead>
                        <tbody id="modalTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock content %}

{% block scripts %}
{# --- ADDED FLATPICKR.JS --- #}
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const dateRangeTypeSelect = document.getElementById('date_range_type');
        const startDateInput = document.getElementById('start_date');
        const endDateInput = document.getElementById('end_date');
        const stockSymbolSelect = document.getElementById('stock_symbol');
        const detailModal = document.getElementById('detailModal');
        const closeButtons = document.querySelectorAll('.close-button');
        const modalTitle = document.getElementById('modalTitle');
        const modalTableBody = document.getElementById('modalTableBody');
        const modalSpinner = document.getElementById('modalSpinner');
        const sortableHeaders = document.querySelectorAll('#detailModal .sortable-th');
        const matchingButton = document.getElementById('matchingButton');
        
        // Load data from Django context
        const availableDatesDb = {{ available_dates_db_json|safe }};
        const brokerNameMap = {{ broker_name_map_json|safe }};
        const sortedAvailableDates = [...availableDatesDb].sort().reverse();
        
        // Get CSRF token
        const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        
        let originalDetailedData = [];
        let currentDetailedData = [];
        let isMatchingFilterActive = false;
        let currentSortColumn = null;
        let currentSortDirection = 'asc';

        // --- NEW: Initialize flatpickr ---
        flatpickr("#start_date", {
            dateFormat: "Y-m-d",
            enable: availableDatesDb.length ? availableDatesDb : undefined,
        });
        flatpickr("#end_date", {
            dateFormat: "Y-m-d",
            enable: availableDatesDb.length ? availableDatesDb : undefined,
        });
        // --- END NEW ---

        function getNthTradingDay(targetDateStr, numDays, availableDates, direction = 'backward') {
            let targetDate = new Date(targetDateStr);
            targetDate.setHours(0, 0, 0, 0);
            let foundDatesCount = 0;
            let resultDate = targetDate;
            if (direction === 'backward') {
                for (let i = 0; i < availableDates.length; i++) {
                    let currentDate = new Date(availableDates[i]);
                    currentDate.setHours(0, 0, 0, 0);
                    if (currentDate <= targetDate) {
                        foundDatesCount++;
                        resultDate = currentDate;
                        if (foundDatesCount >= numDays) { break; }
                    }
                }
            } else if (direction === 'forward') {
                const ascAvailableDates = [...availableDates].sort();
                for (let i = 0; i < ascAvailableDates.length; i++) {
                    let currentDate = new Date(ascAvailableDates[i]);
                    currentDate.setHours(0, 0, 0, 0);
                    if (currentDate >= targetDate) {
                        foundDatesCount++;
                        resultDate = currentDate;
                        if (foundDatesCount >= numDays) { break; }
                    }
                }
            }
            return resultDate.toISOString().split('T')[0];
        }

        // --- CORRECTED DATE LOGIC ---
        function updateDateInputsDisplay() {
            const selectedType = dateRangeTypeSelect.value;
            const endDateValue = endDateInput.value;

            // Set disabled state based on selection
            const isCustom = (selectedType === 'custom');
            startDateInput.disabled = !isCustom;
            endDateInput.disabled = !isCustom;
            
            if (selectedType === 'current_day') {
                if (sortedAvailableDates.length > 0) {
                    const latestDate = sortedAvailableDates[0];
                    startDateInput.value = latestDate;
                    endDateInput.value = latestDate;
                } else {
                    const today = new Date().toISOString().split('T')[0];
                    startDateInput.value = today;
                    endDateInput.value = today;
                }
                return;
            }
            if (selectedType === 'custom') { 
                return; // Do nothing, keep user's custom dates
            }
            
            // For all other types, calculate start date
            if (!endDateValue) return; // Don't calculate if end date is empty
            
            let numDays;
            switch (selectedType) {
                case '1_week': numDays = 7; break;
                case 'fortnight': numDays = 15; break;
                case 'monthly': numDays = 30; break;
                case 'quarterly': numDays = 90; break;
                case 'semi_annually': numDays = 180; break;
                case 'yearly': numDays = 360; break;
                default: return;
            }
            const calculatedStartDate = getNthTradingDay(endDateValue, numDays, sortedAvailableDates, 'backward');
            startDateInput.value = calculatedStartDate;
        }

        dateRangeTypeSelect.addEventListener('change', updateDateInputsDisplay);
        endDateInput.addEventListener('change', updateDateInputsDisplay);
        // --- END DATE LOGIC ---

        function renderModalTable(data, emptyMessage = "No detailed data available for this selection.") {
            modalTableBody.innerHTML = '';
            if (data.length > 0) {
                data.forEach(row => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${row["contract_no"]}</td>
                        <td>${row["stock_symbol"]}</td>
                        <td>${row["buyer"]}</td>
                        <td>${row["seller"]}</td>
                        <td class="text-end">${parseFloat(row["quantity"]).toLocaleString('en-IN', {minimumFractionDigits: 0, maximumFractionDigits: 0})}</td>
                        <td class="text-end">${parseFloat(row["rate"]).toFixed(2)}</td>
                        <td class="text-end">${parseFloat(row["amount"]).toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                    `;
                    modalTableBody.appendChild(tr);
                });
            } else {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td colspan="7" class="text-center py-4">${emptyMessage}</td>`;
                modalTableBody.appendChild(tr);
            }
        }

        async function showDetailModal(type, name) {
            const brokerFullName = brokerNameMap[name] || 'Unknown Broker'; 
            modalTitle.textContent = `Loading Details for ${type.charAt(0).toUpperCase() + type.slice(1)}: ${name} (${brokerFullName})`;
            modalTableBody.innerHTML = '';
            modalSpinner.style.display = 'block';
            matchingButton.classList.add('d-none');
            detailModal.style.display = 'block';
            const selectedStock = stockSymbolSelect.value;
            const startDate = startDateInput.value;
            const endDate = endDateInput.value;
            currentSortColumn = null;
            currentSortDirection = 'asc';
            sortableHeaders.forEach(header => {
                header.classList.remove('asc', 'desc');
            });
            try {
                const response = await fetch("{% url 'floorsheet_analysis:get_floorsheet_details' %}", {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrftoken
                    },
                    body: JSON.stringify({
                        stock_symbol: selectedStock,
                        start_date: startDate,
                        end_date: endDate,
                        type: type,
                        name: name
                    }),
                });
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP error! status: ${response.status}, message: ${errorText}`);
                }
                originalDetailedData = await response.json();
                currentDetailedData = [...originalDetailedData];
                isMatchingFilterActive = false;
                matchingButton.textContent = 'Matching';
                matchingButton.classList.remove('d-none');
                modalTitle.textContent = `Details for ${type.charAt(0).toUpperCase() + type.slice(1)}: ${name} (${brokerFullName})`;
                modalSpinner.style.display = 'none';
                renderModalTable(currentDetailedData);
            } catch (error) {
                console.error('Error fetching detailed data:', error);
                modalSpinner.style.display = 'none';
                matchingButton.classList.add('d-none');
                modalTitle.textContent = `Error loading details for ${type.charAt(0).toUpperCase() + type.slice(1)}: ${name} (${brokerFullName})`;
                modalTableBody.innerHTML = `<tr><td colspan="7" class="text-center py-4 text-danger">Failed to load data.</td></tr>`;
            }
        }

        function sortModalTable(column) {
            if (!currentDetailedData || currentDetailedData.length === 0) return;
            if (currentSortColumn === column) {
                currentSortDirection = (currentSortDirection === 'asc') ? 'desc' : 'asc';
            } else {
                currentSortColumn = column;
                currentSortDirection = 'asc';
            }
            currentDetailedData.sort((a, b) => {
                let valA = a[column];
                let valB = b[column];
                if (['id', 'contract_no', 'quantity', 'rate', 'amount'].includes(column)) {
                    valA = parseFloat(valA) || 0;
                    valB = parseFloat(valB) || 0;
                }
                if (valA < valB) { return currentSortDirection === 'asc' ? -1 : 1; }
                if (valA > valB) { return currentSortDirection === 'asc' ? 1 : -1; }
                return 0;
            });
            sortableHeaders.forEach(header => {
                header.classList.remove('asc', 'desc');
                if (header.dataset.sortBy === column) {
                    header.classList.add(currentSortDirection);
                }
            });
            renderModalTable(currentDetailedData);
        }

        function toggleMatchingFilter() {
            isMatchingFilterActive = !isMatchingFilterActive;
            currentSortColumn = null;
            sortableHeaders.forEach(header => header.classList.remove('asc', 'desc'));
            if (isMatchingFilterActive) {
                currentDetailedData = originalDetailedData.filter(row => row.buyer === row.seller);
                renderModalTable(currentDetailedData, 'No matching transaction done.');
                matchingButton.textContent = 'Show All';
            } else {
                currentDetailedData = [...originalDetailedData];
                renderModalTable(currentDetailedData);
                matchingButton.textContent = 'Matching';
            }
        }

        document.querySelectorAll('.clickable-detail').forEach(element => {
            element.addEventListener('click', function() {
                const type = this.dataset.type;
                const name = parseInt(this.dataset.name, 10);
                showDetailModal(type, name);
            });
        });

        sortableHeaders.forEach(header => {
            header.addEventListener('click', function() {
                const column = this.dataset.sortBy;
                sortModalTable(column);
            });
        });

        matchingButton.addEventListener('click', toggleMatchingFilter);

        closeButtons.forEach(button => {
            button.addEventListener('click', function() {
                const modal = this.closest('.modal');
                if (modal) { modal.style.display = 'none'; }
            });
        });

        window.addEventListener('click', function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        });

        // Add tooltips
        document.querySelectorAll('.clickable-detail').forEach(element => {
            const brokerId = element.dataset.name;
            const brokerName = brokerNameMap[brokerId];
            if (brokerName) {
                element.setAttribute('title', brokerName);
            }
        });
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
{% endblock scripts %}